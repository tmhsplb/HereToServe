
@{
    ViewBag.Title = "Now Serving";
    Layout = "~/Views/Shared/_Client.cshtml";
}

<br/><br/><br/>

<div>
    <table id="clientGrid"></table>
    <div id="clientPager"></div>
</div>


<link href="@Url.Content("~/Content/jquery.jqGrid/copied.ui.jqgrid.css")" rel="stylesheet" />

<script src="@Url.Content("~/Scripts/i18n/grid.locale-en.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.jqGrid.min.js")" type="text/javascript"></script>

<script type="text/javascript">
    var lastServed = 0;
    var rowsToColor = [];

    $("#clientGrid").jqGrid({
        url: "@Url.Action("GetNowServing", "Client")",
        datatype: "json",
        pageable: true,
        mtype: "Get",
        colNames: ['Id', 'ST', 'WT', 'Stage','Last Name', 'First Name', 'Middle Name', 'Birth Name', 'DOB', 'Age', 'EXP', 'HIS', 'PND', 'XID', 'XBC', 'Notes'],
        colModel: [
        { key: true, hidden: true, name: 'Id', index: 'Id' },
        { key: false, align: 'center', name: 'ServiceTicket', index: 'ServiceTicket', width: 50, editable: true, sortable: true, search: false },
        { key: false, align: 'center', name: 'WaitTime', index: 'WaitTime', width: 50, editable: false, sortable: true, search: false },
        { key: false, name: 'Stage', index: 'Stage', width: 100, editable: true, edittype: 'select', editoptions: { value: { 'Screened': 'Screened', 'CheckedIn': 'CheckedIn', 'Interviewing' : 'Interviewing', 'Interviewed' : 'Interviewed', 'BackOffice' : 'BackOffice', 'Done' : 'Done' } }, sortable: false, search: false },
        { key: false, name: 'LastName', index: 'LastName', width: 150, editable: true, sortable: false, search: false },
        { key: false, name: 'FirstName', index: 'FirstName', width: 150, editable: true, sortable: false, search: false },
        { key: false, name: 'MiddleName', index: 'MiddleName', width: 150, editable: true, sortable: false, search: false },
        { key: false, name: 'BirthName', index: 'BirthName', width: 150, editable: true, sortable: false, search: false },
        { key: false, align: 'center', name: 'DOB', index: 'DOB', width: 100, editable: true, sortable: true, search: false },
        { key: false, align: 'center', name: 'Age', index: 'Age', width: 50, editable: false, sortable: false, search: false },
        { name: 'EXP', index: 'EXP', align: 'center', width: 50, editable: true, edittype: "checkbox", editoptions: { value: "Y:''" }, },
        { name: 'History', index: 'History', align: 'center', width: 50, editable: false, sortable: false, search: false },
        { name: 'PND', index: 'PND', align: 'center', width: 50, editable: true, edittype: "checkbox", editoptions: { value: "Y:''" }, },
        { name: 'XID', index: 'XID', align: 'center', width: 50, editable: true, edittype: "checkbox", editoptions: { value: "Y:''" } },
        { name: 'XBC', index: 'XBC', align: 'center', width: 50, editable: true, edittype: "checkbox", editoptions: { value: "Y:''" }, },
        { key: false, name: 'Notes', index: 'Notes', width: 150, editable: true, sortable: false, search: false, edittype: 'textarea', editoptions: { rows: '2', columns: '10' }  }
        ],
        pager: '#clientPager',
        rowNum: 1,
        height: "100%",
        viewrecords: true,
        loadonce: false,

        
        caption: 'Now Serving',
        emptyrecords: 'No records to display',
        jsonReader: {
            root: "rows",
            page: "page",
            total: "total",
            records: "records",
            repeatitems: false,
            id: "Id"
        },
        autowidth: true,
        multiselect: false
    })

    jQuery("#clientGrid").jqGrid('navGrid', '#clientPager', { edit: false, add: false, del: false, search: false, refresh: false });
      
 </script>      
       

<script type="text/javascript" src="@Url.Content("~/Scripts/jquery.signalR-2.4.1.min.js")"></script>

<script type="text/javascript" src="~/signalr/hubs"></script>

<script>
    $(function () {
        var theHub = $.connection.dailyHub;

        theHub.client.refreshClientPage = function (atBat) {
            var url = "@Url.Action("GetNowServingSignalR", "Client", new {nowServing = "atBat" })";

            url = url.replace("atBat", encodeURIComponent(atBat));

           // alert("url = " + url);

            $.ajax({
                url: url,
                cache: false,
                dataType: "json",
                success: function (data) {
                    var mygrid = jQuery("#clientGrid")[0];
                    mygrid.addJSONData(data);
                }
             });
        };

        $.connection.hub.start().done(function () {
        });
    });
</script>

