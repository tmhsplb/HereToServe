@model OPIDDaily.Models.RequestedServicesViewModel

@{
    ViewBag.Title = "Existing Client";
    Layout = "~/Views/Shared/_FrontDesk.cshtml";
}

<br /><br/><br/>

<div>
    <table id="historyGrid"></table>
    <div id="historyPager"></div>
</div>

<link href="@Url.Content("~/Content/jquery.jqGrid/copied.ui.jqgrid.css")" rel="stylesheet" />

<script src="@Url.Content("~/Scripts/i18n/grid.locale-en.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.jqGrid.min.js")" type="text/javascript"></script>

<script type="text/javascript">
    $("#historyGrid").jqGrid({
        url: "@Url.Action("GetVisitHistory", "FrontDesk")",
        datatype: "json",
        mtype: "Get",
        colNames: ['Id', 'Date', 'Item', 'Check', 'Status', 'Notes'],
        colModel: [
        { key: true, hidden: true, name: 'Id', index: 'Id' },
        { key: false, align: 'center', name: 'Date', index: 'Date', formatter: 'date', width: 80, editable: true, sortable: true, search: false },
        { key: false, name: 'Item', index: 'Item', width: 80, editable: true, sortable: false, search: false },
        { key: false, name: 'Check', index: 'Check', width: 80, editable: true, sortable: false, search: false },
        { key: false, name: 'Status', index: 'Status', width: 100, editable: true, edittype: 'select', editoptions: { value: { '':'', 'Cleared': 'Cleared', 'Voided': 'Voided', 'Voided/No Reissue': 'Voided/No Reissue', 'Voided/Resissued': 'Voided/Reissued', 'Voided/Replaced': 'Voided/Replaced', 'Used': 'Used', 'Not Used': 'Not Ussed' } }, sortable: false, search: false },
        { key: false, name: 'Notes', index: 'Notes', width: 150, editable: true, sortable: false, search: false, edittype: 'textarea', editoptions: { rows: '2', columns: '10' }  }
        ],
        pager: '#historyPager',
        rowNum: 25,
        height: "100%",
        viewrecords: true,
        loadonce: false,
        caption: 'Previous visits by ' + '@ViewBag.ClientName',
        emptyrecords: 'No records to display',
        jsonReader: {
            root: "rows",
            page: "page",
            total: "total",
            records: "records",
            repeatitems: false,
            id: "Id"
        },
        autowidth: true,
        multiselect: false
    })

    jQuery("#historyGrid").jqGrid('navGrid', '#historyPager', { edit: true, add: true, del: true, search: false, refresh: false },
      {
          zIndex: 100,
          url: "@Url.Action("EditVisit", "FrontDesk")",
          closeOnEscape: true,
          closeAfterEdit: true,
          recreateForm: true,
          afterComplete: function (response) {
              if (response.responseText) {
                //  alert("FrontDesk: " + response.responseText);
              }
          }
      },
      {
          zIndex: 100,
          url: "@Url.Action("AddVisit", "FrontDesk")",
          closeOnEscape: true,
          closeAfterAdd: true,
          recreateForm: true,
          afterComplete: function (response) {
              if (response.responseText) {
                  if (response.responseText != "Success") {
                      alert(response.responseText);
                  }
              }
          }
      },
      {
          zIndex: 100,
          url: "@Url.Action("DeleteVisit", "FrontDesk")",
          closeOnEscape: true,
          closeAfterDelete: true,
          recreateForm: true,
          afterComplete: function (response) {
              if (response.responseText) {
                //   alert(response.responseText);
              }
          }
        });

     // http://www.trirand.com/blog/?page_id=393/help/how-to-use-add-form-dialog-popup-window-set-position
    $.extend($.jgrid.edit, {
        recreateForm: true,
        closeAfterAdd: true,
        dataheight: '100%',
        reloadAfterSubmit: true,
        width: 500,
        top: 300,
        left: 150,
        addCaption: "Add Visit",
        editCaption: "Edit Visit",
        bSubmit: "Submit",
        bCancel: "Cancel",
        bClose: "Close",
        saveData: "Data has been changed! Save changes?",
        bYes: "Yes",
        bNo: "No",
        bExit: "Cancel"
    });
</script>

<br />
@*
<table>
    <tr>
        <td><a class="button" href="@Url.Action("GetClientHistory", "Frontdesk")">Show Client History</a></td>
        <td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
        <td><a class="button" href="@Url.Action("ClearClientHistory", "Frontdesk")">Clear Client History</a></td>
    </tr>
</table>
*@

<div class="col-md-12">
    <section id="existingclientServicesForm">
        @using (Html.BeginForm("PrepareExistingClientVisits", "FrontDesk", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", role = "form" }))
        {
            @Html.AntiForgeryToken()
            <div class="form-group">
                <div class="col-md-10">
                    <input type="submit" value="Prepare Visits Only" class="btn btn-default" />
                </div>
            </div>
        }
    </section>
</div>
<br/>

<style>
    input[type="checkbox"] {
        transform: scale(0.75,0.75);
    }
</style>

<br />
<h3>Existing Client: @ViewBag.ClientName</h3>
<h4>DOB: @ViewBag.DOB (Age @ViewBag.Age)</h4>
<br />

<div class="row">
    <div class="col-md-12">
        <section id="existingclientForm">
            @using (Html.BeginForm("PrepareExistingClient", "FrontDesk", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", role = "form" }))
            {
                @Html.AntiForgeryToken()

                @* @Html.Partial("_PreApproval", Model) *@
 
                <h4>Requested Services</h4>
                <hr />

                <div class="form-group">
                    <div class="col-md-12">
                        @Html.DropDownListFor(model => model.Agency, Model.Agencies, "Select Agency", new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Agency, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.BC, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.BC, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedBC, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedBC, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.HCC, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.HCC, new { @class = "control-label" })
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.MBVD, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.MBVD, new { @class = "control-label" })
                    </div>
                    <div class="col-md-4">
                        @Html.TextBoxFor(m => m.State, new { placeholder = "State", @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedMBVD, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedMBVD, new { @class = "control-label" })
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.NewTID, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.NewTID, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedNewTID, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedNewTID, new { @class = "control-label" })
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.ReplacementTID, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.ReplacementTID, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedReplacementTID, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedReplacementTID, new { @class = "control-label" })
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.NewTDL, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.NewTDL, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedNewTDL, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedNewTDL, new { @class = "control-label" })
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.ReplacementTDL, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.ReplacementTDL, new { @class = "control-label" })
                    </div>
                    <div class="col-md-2">
                        @Html.CheckBoxFor(m => m.PreApprovedReplacementTDL, new { @class = "form-control" })
                    </div>
                    <div class="col-md-2">
                        @Html.LabelFor(m => m.PreApprovedReplacementTDL, new { @class = "control-label" })
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <div class="col-md-10">
                        <input type="submit" value="Prepare Service Ticket" class="btn btn-default" />
                    </div>
                </div>
            }
        </section>
    </div>
</div>